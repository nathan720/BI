# 数据计算与格式化指南

本文档介绍了 BI 系统中图表数据计算与格式化的使用方法，包括通用格式化选项和自定义 JavaScript 脚本功能。

## 1. 通用数据格式 (Format)

在图表配置的“数据”选项卡中，您可以在 Y 轴 (数值/指标) 的配置表格中找到“格式”列。系统提供了一系列预设的标准格式，选择后会自动应用到图表的轴标签、系列标签和提示框 (Tooltip) 中。

### 支持的格式类型：

- **默认 (Default)**: 不进行特殊处理，直接显示原始数值。
- **整数 (Integer)**: 对数值进行四舍五入取整 (相当于 `Math.round`)。
- **1位小数 (Float 1)**: 保留 1 位小数 (相当于 `toFixed(1)`)。
- **2位小数 (Float 2)**: 保留 2 位小数 (相当于 `toFixed(2)`)。
- **百分比 (Percent)**: 将数值乘以 100，保留 2 位小数，并添加 `%` 后缀。
- **货币 (Currency)**: 保留 2 位小数，并添加货币符号 `¥` (人民币)。

---

## 2. 自定义JS脚本 (Custom JS)

如果您需要更复杂的数据处理逻辑（例如单位转换、条件格式化等），可以选择“格式”下拉菜单中的 **“自定义JS”** 选项。

选择后，右侧会出现一个输入框，您可以在其中编写 JavaScript 代码片段。

### 工作原理

系统会将当前的数据值作为变量 `value` 传入您的代码片段。您需要编写一段返回处理后结果的 JavaScript 代码。

**基本语法:**
```javascript
return value * 100;
```

### 常用代码示例

以下是一些常见的自定义脚本示例，您可以直接复制使用：

| 场景 | 代码示例 | 说明 |
| :--- | :--- | :--- |
| **单位转换 (元 -> 万元)** | `return (value / 10000).toFixed(2) + ' 万';` | 将数值除以 10000，保留 2 位小数，并添加“万”作为后缀。 |
| **保留 4 位小数** | `return value.toFixed(4);` | 强制保留 4 位小数。 |
| **条件颜色/文本** | `if(value > 100) return value + ' (高)'; else return value;` | 如果数值大于 100，添加“(高)”标记。 |
| **取绝对值** | `return Math.abs(value);` | 将负数转换为正数。 |
| **向下取整** | `return Math.floor(value);` | 去除小数部分（不四舍五入）。 |
| **千分位分隔符** | `return value.toLocaleString();` | 将数值格式化为带千分位的字符串 (如 1,234,567)。 |
| **自定义后缀** | `return value + ' kg';` | 添加自定义单位后缀。 |

### 注意事项

1. **安全性**: 代码在浏览器端执行，请勿包含敏感信息或恶意代码。
2. **错误处理**: 如果代码执行出错，系统会默认显示原始数值，并在控制台记录错误。
3. **上下文**: 在轴标签和系列标签中，`value` 通常是数字；在提示框中，可能会包含更多上下文信息，但建议主要针对数值进行处理。

---

## 3. 图表标签样式配置

除了数据内容的计算和格式化，您还可以自定义图表标签 (Label) 的样式：

- **显示**: 控制是否显示数值标签。
- **字体大小**: 设置标签文字的大小 (像素)。
- **字体颜色**: 设置标签文字的颜色 (支持 HEX, RGB, 颜色名称)。

这些设置可以在 Y 轴配置表格的“标签样式”列中找到。
